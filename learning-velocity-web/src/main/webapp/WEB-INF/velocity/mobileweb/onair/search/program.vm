#uaCheck()
#set($urlParam = "programName="+$!{command.programName})
#set($minDay = "$CheckDate.getTodayDiffDate(-30)")
#set($searchDate = $!{command.searchDate})
#set($link = "/onair/search/program?"+$urlParam+"&")

<div id="daumContent" class="cont_now" role="main">
<div id="mArticle">
	<h2 class="screen_out">방금 그 곡</h2>
	<div class="now_navi">
		<h3 class="tit_navi">상세검색</h3>
		<a href="javascript:;" class="btn_prev" onclick="window.history.back();"><span class="ico_now ico_prev"></span>이전</a>
	</div>
	<strong class="screen_out">채널 선택</strong>
	#parse("/velocity/mobileweb/onair/search/menu.vm")	
	<h4 class="screen_out">프로그램</h4>
	<form id="searchProgramForm" action="/onair/search/program" class="form_nowsearch">
		##<input name="searchDate" type="hidden" title="검색어 입력" value="$!{command.searchDate}">
		<fieldset>
			<legend class="screen_out">프로그램 검색 폼</legend>
			<div class="box_search">
				<input id="tfSearch" name="programName" type="search" class="tf_keyword" title="검색어 입력" value="$!{command.programName}">
				<button type="submit" class="btn_search"><span class="ico_now">검색</span></button>
			</div>
			#if($StringUtils.isBlank($!{command.programName}))
			<p class="txt_noti">
				프로그램명을 입력하시면, 해당 프로그램의 BGM 혹은 선곡표를 날짜별로 보실 수 있습니다(모바일에서는 최근 30일까지만 검색 가능)
			</p>
			#else
				#if($CollectionUtils.isEmpty($schProgramList))
				<p class="txt_noti result_type1">
					검색 결과가 없습니다 <br>
					입력하신 프로그램명이 정확한지 확인해주세요
				</p>
				
            	#end
				
			#end
		</fieldset>
	</form>


#if($CollectionUtils.isNotEmpty($schProgramList))
	
#if($StringUtils.isNotBlank($!{command.programName}))	
	<div id="parentCalwrap" class="now_date time_open"><!-- date_open, time_open 클래스 추가시 달력 활성화-->
		<strong class="screen_out">날짜</strong>
		##<button type="button" class="btn_timeset"><span class="ico_now">시간 상세 설정 열기</span></button>
		<!-- 달력부분 마크업은 기존과 동일합니다 -->
		<div id="dateCon">
			<div class="date_cont">
				

				#if( $MathTool.toNumber("$!{searchDate}") > $MathTool.toNumber("$!{minDay}") )
					<a class="link_date" href="$!{link}searchDate=$!CheckDate.getDiffDate($searchDate, -1)"><span class="ico_now ico_prev">이전 날</span></a>
				#else
					<em class="link_date"><span class="ico_now ico_prev">이전 날</span></em>
				#end	
	        		<span class="cont_date"><span class="date_num">$CheckDate.makeReleaseDate("$!{searchDate}")</span>($CheckDate.getDayNameByDate("$!{searchDate}"))</span>
				#if($MathTool.toNumber($CheckDate.diffOfDate("$!{searchDate}")) > 0)	
					<a class="link_date" href="$!{link}searchDate=$CheckDate.getDiffDate($searchDate, 1)"><span class="ico_now ico_next">다음 날</span></a>
				#else
					<em class="link_date"><span class="ico_now ico_next">다음 날</span></em>
				#end 
	        </div>

	    </div>
		<div id="monthCon">

	    </div>
		<div id="calendarBtnCon">
			#if($StringUtils.isNotBlank("$!{searchDate}"))
			<a  href="javascript:;" class="btn_calendar" onclick="calendarLayer.toggle('$!{searchDate}');return false;"><span class="ico_now ico_calendar">달력 열기/닫기</span></a>
			#end
	    </div>
		<div id="calwrap" class="calendar_comm">
    		
    	</div>
		<script type="text/javascript">
			// 달력

        	var changeTimelineLocation = function(searchDate){
				location.href = "/onair/search/program?${urlParam}&searchDate=" + searchDate;
			}
			
        	// 레이어 달력	
        	var calendarLayer = new music.mobile.OnairCalendar(
        		{
        			selectedDay : "$!searchDate",
        			calContainerId : "calwrap",
        			useScheduleDays : false,
        			selectDateAddFunc : changeTimelineLocation,
					minDay : "$!minDay",
					parentCalwrapId : "parentCalwrap",
					dateContainerId : "monthCon",
					calentBtnContainerId :  "calendarBtnCon"
        		}
        	);
        	</script>	

	</div>
	
	

#if(!$CollectionUtils.isEmpty($schduleKeyList))		
	#foreach($schduleKey in $schduleKeyList)
	
		
	#set($channelSongListByDate = ${channelSongMap.get($schduleKey)})	
	
	#if(!$CollectionUtils.isEmpty($channelSongListByDate))
	
	<strong class="screen_out">곡 리스트</strong>
	<ul class="list_timeline">
	#set($count = 0)
	#set($songStartTime = "")
	#foreach($channelSong in $channelSongListByDate)
		#set($count = $count+1)
    	#if($count == 1)
			#set($songStartTime = ${channelSong.startTime})
		#end
    	
    	<li #if("$!{channelSong.hotYn}" == "Y" && "$!{channelSong.copy}" != "")class="hot"#end>
			#if("$!{channelSong.hotYn}" == "Y" && "$!{channelSong.copy}" != "")
				<span class="timeline_hot"><em class="emph_hot">HOT</em><span class="txt_hot">$!{channelSong.copy}</span></span>	
    		#end
			<!-- 2014-04-02 수정 시작 --> 
    		#if("$!{channelSong.song.album.albumId}" != "0")
    		<a href="/album/main?album_id=${channelSong.song.album.albumId}" class="link_album">
    		#else
    		<a href="#none" class="link_album">
    		#end
    			#if("$!{channelSong.song.album.albumId}" != "0" && "$!{channelSong.song.album.mainImage.filePath}" != "")
        		<img src='$ImageUtil.getMobileImageUrl("$!{channelSong.song.album.mainImage.filePath}", "100x100", "ALBUM", "C")' width="50" height="50" class="thumb_img" alt="${channelSong.title}">
        		#else
        		<img src="http://m1.daumcdn.net/img-media/mobile/m640/music/img_none2.jpg"  width="50" height="50" class="thumb_img" alt="${channelSong.title}">
        		#end
    		</a>
    		<a href="javascript:;" class="link_info" onclick="music.mobile.Timeline.moreViewLayer(this);">
    			<span class="timeline_info">
    				<span class="txt_time"><span class="ico_now ico_time">방송시간 </span><span class="txt_num" data-time="${channelSong.startTime}">$!{channelSong.startTime.substring(8,10)}:$!{channelSong.startTime.substring(10,12)}</span></span>
    				<strong class="tit_song"><span class="screen_out">곡명 </span>#if(${channelSong.songId} != 0)#strCut(${channelSong.song.title}, 30) #else #strCut(${channelSong.title}, 30)#end - <span class="screen_out">아티스트명 </span>
    					#if("$!{channelSong.song.songId}" != "0")
    						#set($artistCount = 0)
    						#set($etcArtistCount = 0)
    						#foreach($songArtist in $!{channelSong.song.keyArtistList})
    							#set($artistCount = $artistCount +1)
								#set($strCutLen = 10)
    							#if($!{channelSong.song.keyArtistList.size()} == 1)
    								#set($strCutLen = 30)
    							#end								
    							#strCut(${songArtist.name}, $strCutLen, "..")#if($artistCount < $!{channelSong.song.keyArtistList.size()} && $artistCount < 2),#end
    							#if($artistCount == 2) #set($etcArtistCount = $!{channelSong.song.keyArtistList.size()} - 2) #break #end
    						#end
    						#if($etcArtistCount > 0)
    						외 ${etcArtistCount}명 
    						#end
    					#else #strCut($!{channelSong.artistName}, 30, "..")
    					#end
    				</strong> <!-- off 클래스 추가시 딤드 처리 -->
					#set($printProgramName = "")
					#if($StringUtils.isNotBlank("$!{command.programName}"))
						#if($channelSong.schedule.programName.matches("(?i).*($!{command.programName}).*"))
							#set($matchStr = $channelSong.schedule.programName.replaceAll("(?i).*($!{command.programName}).*","$1"))
						#else
							#set($matchStr = "")
						#end
						#set($printProgramName = $channelSong.schedule.programName.replace("$matchStr","<span style='color:#fb6765'>$matchStr</span>"))
					#else
						#set($printProgramName = $channelSong.schedule.programName)
					#end
					
    				<span class="txt_info"><span class="screen_out">프로그램 </span>${channelSong.channel.channelName} - $!{printProgramName}</span>
    			</span>
    			<span class="btn_side"><span class="ico_now ico_fold">추가 제공 서비스 열기/닫기</span></span>
    		</a>
			#if($ua_result.os.ios)
				 #if($MathTool.toNumber($ua_result.browser.major) > 3)
					<a href="javascript:;" class="btn_side #if("$!{channelSong.song.songId}" == 0 || "$!{channelSong.song.AODLinkId}" == "" || "$!{channelSong.song.AODLinkId}" =="0")btn_off#end" #if("$!{channelSong.song.songId}" != 0 && "$!{channelSong.song.AODLinkId}" != "" && "$!{channelSong.song.AODLinkId}" !="0") onclick="music.mobile.mMusicPlay.playOnApp('SO', '$!{channelSong.song.songId}','$!{channelSong.song.album.albumId}');return false;" #end><span class="ico_now ico_listen">듣기</span></a>
				#else
					<a href="javascript:;" class="btn_side onclick="alert('사용하시는 IOS 버전에서는 지원하지 않는 기능입니다. IOS를 최신버전으로 업그레이드 해 주세요');"><span class="ico_now ico_listen">듣기</span></a>
				#end
			#elseif($ua_result.os.android)
				<a href="javascript:;" class="btn_side #if("$!{channelSong.song.songId}" == 0 || "$!{channelSong.song.AODLinkId}" == "" || "$!{channelSong.song.AODLinkId}" =="0")btn_off#end" #if("$!{channelSong.song.songId}" != 0 && "$!{channelSong.song.AODLinkId}" != "" && "$!{channelSong.song.AODLinkId}" !="0") onclick="music.mobile.mMusicPlay.playOnApp('SO', '$!{channelSong.song.songId}', '$!{channelSong.song.album.albumId}');return false;" #end><span class="ico_now ico_listen">듣기</span></a>
			#else
				<a href="javascript:;" class="btn_side btn_off"><span class="ico_now ico_listen">듣기</span></a>
			#end
    		<div class="timeline_fold">
    			#btnPlayListOnAir($!{channelSong.schedule.programId}, "program", $!{channelSong.channel.mediaType}, $!{channelSong.channel.channelId})
    			#btnPlayListOnAir($!{channelSong.song.songId}, "lyrics", $!{channelSong.sogn.lyricsYn}, $!{channelSong.song.album.albumId})
    			#btnPlayListOnAir($!{channelSong.song.songId}, "buy", $!{channelSong.song.MP3LinkId}, $!{channelSong.song.album.albumId})
    			#btnPlayListOnAir($!{channelSong.song.songId}, "app", $!{channelSong.song.AODLinkId}, $!{channelSong.song.album.albumId})
    		</div>
    		#if("$!{channelSong.song.songId}" != 0 && "$!{channelSong.song.AODLinkId}" != "" && "$!{channelSong.song.AODLinkId}" !="0")
    		<div id="sId_${channelSong.song.songId}_$foreach.index" class="audio"></div>
    		#end
    	</li>
    	
    	#if($count == ${songList.size()})
    		#set($songEndTime = ${channelSong.startTime})	
    	#end
    	
    #end
	</ul>	
	 <a href="javascript:;" class="btn_more" onclick="music.mobile.SearchTimeLine.getBottomSongList();return false;">펼쳐보기<span class="ico_now ico_more"></span></a> <!-- 2014-04-02 클래스 수정 -->
	
	
	 #end
	 
	#end 
	 

#else
	
	 <p class="txt_noti result_type2">
		해당하는 프로그램이 없습니다<br>
		다른날짜를 선택해주세요
	</p>
	
	
	
#end	
	
	<a href="/onair/timeline" class="link_sort link_live"><span class="ico_now"></span>실시간 보기</a>


#end
#end


	#print_onAirBanner($bannerList)	
	#SearchForm("only_bottom")

</div>
</div>
#parse("/velocity/mobileweb/realtimeissue.vm")	


<script type="text/javascript">

	var nextPageNo = $!{command.pageNo}+1;
	#if("$!totalPage" != "")
	var totalPage = $!totalPage;
	#else
	var totalPage = 0;
	#end
	var option = {
	 	 programName : "$!{command.programName}",
		 nextPageNo : nextPageNo,
		 searchDate : "$!{command.searchDate}",
		 totalCnt : ${totalCnt},
		 totalPage : totalPage, 
		 songStartTime : "${songStartTime}",
		 songEndTime : "${songEndTime}",
		 type : "program"
	};
	
	jQuery("document").ready(
    function(){
    	new music.mobile.SearchTimeLine.init(option);
    });
	
</script>





#if( $StringUtils.equals("$!{command.debugmode}","2") )
</br>
</br>
#set($date = $!{command.searchDate})
searchDate : $!searchDate </br>
date : $!date </br>
searchSDate : $!{command.searchSDate} -  오늘과 날짜 차 $CheckDate.diffOfDate($!{command.searchSDate})</br>
searchEDate : $!{command.searchEDate} - 오늘과 날짜 차 $CheckDate.diffOfDate($!{command.searchEDate})</br>
earchDueType : $!{command.SearchDueType} </br>
programName : $!{command.programName} </br>
totalcnt : $!{totalCnt} </br>
totalPage : $!{totalPage} </br>
pageNo : $!{command.pageNo} </br>
</br>
</br>

프로그램 스케줄 리스트</br>
#foreach($schdulePro in $schProgramList)
	$schdulePro.programStartTime </br>
		
#end

스케줄리스트 </br>
#foreach($schduleKey in $schduleKeyList)
	$schduleKey </br>
	
	#set($channelSongListByDate = ${channelSongMap.get($schduleKey)})
    곡리스트 : $channelSongListByDate.size()</br>
	#foreach($channelSong in $channelSongListByDate)
			#set($pret = $channelSong.schedule.programName.replaceAll("(?i).*($!{command.programName}).*","$1"))
			#set($pret = $channelSong.schedule.programName.replaceAll("$pret","<span style='color:#fb6765'>$pret</span>"))
			$pret
		</br>
    #end	
#end	

</br>
</br>
#end