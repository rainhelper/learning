#set($songList = $dto.songResult.documentList)
#set($songCount = $dto.songResult.totalResultsCount)
#set($query = $!{command.query})
#set($url = "/search/song/list?query=$!{query}")
#set($artistUrl = "&artistId=$!{command.artistId}")
#set($rangeUrl = "&searchRange=$!{command.searchRange}")
#set($nationUrl = "&nationId=$!{command.nationId}")
#set($genreUrl = "&genreId=$!{command.genreId}")
#set($releaseUrl = "&releaseYear=$!{command.releaseYear}")
#set($listenUrl = "&listenFilter=$!{command.listenFilter}")
#set($mp3Url = "&mp3Filter=$!{command.mp3Filter}")
#set($bgmUrl = "&bgmFilter=$!{command.bgmFilter}")
#set($url = $url + $artistUrl + $rangeUrl + $nationUrl + $genreUrl + $releaseUrl + $listenUrl + $mp3Url + $bgmUrl)

<ul class="tab_cont tab_search">
	#printSearchNaviTab()
</ul>


<div class="section_song">
	#parse("/velocity/search/piece/finder.vm")

	#parse("/velocity/search/piece/highlight.vm")
	
    #if($!{songCount} && $!{songCount} > 0)
	<div class="wrap_title">
		<h3 class="tit_search tit_song">곡</h3>
		<span class="txt_bar"> | </span>
		<span class="txt_quantity">총 <strong class="fc_blue ls_0">$!{songCount}</strong> 건</span>
		
		##if(!$StringUtils.equals("$!{songDetailYn}", "N"))
		<a id="btnMoreInfo" class="btn_search btn_fold" status="$!{command.view_type}" href="javascript:;" onclick="daum.Music.setSongListView(this, 'btn_unfold', 'btn_fold');return false;">곡정보 간단히</a>
		##end
	</div>
	
		<div class="wrap_tool_btn">
			<div class="tool_btn f_l">
				#printListButton("song" "" "" "" "")
			</div>
			
			<div class="sort_option f_r">
				#printSearchSortOption( $url, $!{command.sortType} )
			</div>
		</div>
		
		<div class="bg_thead">
			<input type="checkbox" class="all_chk" id="allCheck">
			<label for="allCheck" class="screen_out">전체선택</label>
		</div>
		
		<table id="trackContainer" class="tbl_music">
			<caption class="screen_out">곡 검색결과</caption>
			#printListHeader( "search" )
			<tbody>
			#if(!$CollectionUtils.isEmpty($songList))
        		#printSearchSongList( $songList "song")
        	#else
        		<tr class="no_listinfo">
    				<td colspan="11">
    					<p class="fc_txt">저장된 곡이 없습니다.</p>	
    				</td>
    			</tr>
    		#end
			</tbody>
		</table>
		#* 
		#if(!$CollectionUtils.isEmpty($!{songList}))
        	<script type="text/javascript">
            var l = [];
            </script>
             
            #foreach($song in $songList)
            ## 예외 처리
            #if( $!{song.song} )
            	#set($song = $song.song)
            #end	
            <script type="text/javascript">
            l.push({
            	songId : '$!{song.songId}',
            	albumId : '$!{song.album.albumId}',
            	title : '#escScriptStrip($!{song.title})',
            	artistname : '#escScriptStrip("#printArtistName( $!{song.keyArtistList} '' 0 false )")',
            	thumb : '$ImageUtil.getImageUrl("$!{song.album.mainImage.filePath}", "200x200", "ALBUM" ,"S")'
            });
            </script>
            #end
            <script type="text/javascript">
            daum.Music.Social.setListData(l);
            l = null;
            </script>
    	#end
		*#
		
		#printSNSList($!{songList})
		
		<div class="wrap_tool_btn wrap_addpage">
			<div class="tool_btn">
				#printListButtonFoot("song" "" "" "" "")
			</div>
			
   			## 페이징
        	#if($StringUtils.isNotBlank("$!{command.sortType}")) #set($url = $url + "&amp;sortType=$!{command.sortType}") #end
        	#set($url = $url + "&amp;page_no=")
        	#printPaging($url, $dto.ph.pageNo, $dto.ph, "f_l", 10)
		</div>
		
		<script type="text/javascript">
			var controller = new daum.Music.ListPrototype();
			controller.initialize({pageType:'chart', arrow:false, colNum:10});
			controller.addClassAndEvent('more_info');
			##if(!$StringUtils.equals("$!{command.view_type}", "simple"))
			
    		domReady( function(){
				if( daum.Browser.getCookie("AVEASY")=="true" ){
       			controller.viewSongInfo("", {el:daum.$$(".section_song .btn_unfold")[0], foldClass:'btn_unfold', unfoldClass:'btn_fold'});
				} else {
				if(daum.$("btnMoreInfo")){ daum.$("btnMoreInfo").setAttribute("status", "detail"); }				
				}
            });
			##end
			new daum.Music.CheckBoxDrag("trackContainer");
    	</script>
    #else
    <ul class="list_search_guide">
    	<li class="ico_comm">검색어의 단어 수를 줄이거나, 보다 일반적인 단어로 검색해 보세요.</li>
    	<li class="ico_comm">두 단어 이상의 키워드로 검색 하신 경우, 정확하게 띄어쓰기를 한 후 검색해 보세요.</li>
    	<li class="ico_comm">키워드에 있는 특수문자를 뺀 후에 검색해 보세요.</li>
    </ul>
	#end
</div>


<div id="FTMessage">
---------------------<br/>
FT 체크<br/>
---------------------<br/>

---------------------<br/>
개발 체크<br/>
---------------------<br/>
- 재생시간 정보<br/>
- 곡정보 자세히(작곡, 작사 정보)<br/>
- 뮤직비디오 없는애들이 있네요<br/>
- 검색쪽 페이징이 전부 안되는듯(pageNo를 줘도 안되네요)<br/>
</div>

#if( $StringUtils.equals("$!{command.debugmode}","2") )

#set($songList = $dto.songResult.documentList)
#set($songCount = $dto.songResult.totalResultsCount)

#set ($url = "?query=$!{command.encodedQuery}")
#if( $StringUtils.isNotEmpty("$!{command.searchRange}") ) #set ($url = $url + "&searchRange=$!{command.searchRange}") #end
#if( $StringUtils.isNotEmpty("$!{command.artistId}") ) #set ($url = $url + "&artistId=$!{command.artistId}") #end
#if( $StringUtils.isNotEmpty("$!{command.genreId}") ) #set ($url = $url + "&genreId=$!{command.genreId}") #end
#if( $StringUtils.isNotEmpty("$!{command.releaseYear}") ) #set ($url = $url + "&releaseYear=$!{command.releaseYear}") #end
#if( $StringUtils.isNotEmpty("$!{command.listenFilter}") ) #set ($url = $url + "&listenFilter=$!{command.listenFilter}") #end
#if( $StringUtils.isNotEmpty("$!{command.bgmFilter}") ) #set ($url = $url + "&bgmFilter=$!{command.bgmFilter}") #end

#if ($StringUtils.equals($!{command.listenFilter},"y") || $StringUtils.equals($!{command.bgmFilter},"y"))
	#set ($songview = "on")
#else
	#if($!{songCount} && $!{songCount} > 0)
		#set ($songview = "on")
	#else
		#set ($songview = "off")
	#end
#end
	
#if($StringUtils.equals($!{songview},"on"))		
	<div class="collTitle">
		<h3 class="fl">곡 <span class="num">총 $!{songCount}건</span></h3>
		<span class="fl">&nbsp;
			#if($StringUtils.equals($!{command.sortType}, "0"))
				<span class="nrl base">정확도</span>
			#else
				<a href="$url&sortType=0" class="stlink" onclick="return gExtraLink(this, 'SRSY', '1')">정확도</a>
			#end
			#if($StringUtils.equals($!{command.sortType}, "1"))
				<span class="nrl vline"> | </span><span class="nrl base">최신</span>
			#else
				<span class="nrl vline"> | </span><a href="$url&sortType=1" class="stlink" onclick="return gExtraLink(this, 'SRSY', '2')">최신</a>
			#end
			#if($StringUtils.equals($!{command.sortType}, "2"))
				<span class="nrl vline"> | </span><span class="nrl base">인기도</span>
			#else
				<span class="nrl vline"> | </span><a href="$url&sortType=2" class="stlink" onclick="return gExtraLink(this, 'SRSY', '3')">인기도</a>
			#end
		</span>
	</div>
	<div class="collWid collTot">
		<div class="tab">
			
			<div class="tabBody conHdMv" id="tabBody_tpItem1">
				<p>
					<span class="btn fl">
						<input type="button" onclick="controlBtn.goAction('all_listen');return gExtraLink(this, 'SRSY', '7');" class="typeBtn btSetAct btActAllListen" value="전체듣기" title="전체듣기" >
                        <input type="button" onclick="controlBtn.goAction('chk_listen');return gExtraLink(this, 'SRSY', '8');" class="typeBtn btSetAct btActSelListen" value="선택듣기" title="선택듣기" >
                        <input type="button" onclick="controlBtn.goAction('chk_mp3', this);return gExtraLink(this, 'SRSY', '9');" class="typeBtn btSetAct btActMp3" >
                        <input type="button" onclick="controlBtn.goAction('chk_bgm', this);return gExtraLink(this, 'SRSY', '10');" class="typeBtn btSetAct btActBgm" >
                        <input type="button" onclick="controlBtn.goAction('chk_my');return gExtraLink(this, 'SRSY', '11');" class="typeBtn btSetAct btActMy" value="MY앨범담기" title="MY앨범담기" >
						## #printListButton("song", "controlBtn")
					</span>
					<span class="chkSongR">
						<input type="checkbox" name="checkBoxR1" id="checkBoxR1" onClick="_jsChkListenYN(this);return gExtraLink(this, 'SRSY', '4');"> 듣기가능
						<input type="checkbox" name="checkBoxR2" id="checkBoxR2" onClick="_jsChkListenYN(this);return gExtraLink(this, 'SRSY', '5');"> 배경음악 구매가능
					</span>
				</p>
				
				<table id="wAbmTbl" class="baseTbl baseTblTypeSch cb">
				<thead>
					<tr>
						<th class="tColChk"><input type="checkbox" name="checkBoxItem" onClick="controlBtn.allCheck(this);"></th>
						<th class="c3">곡명</th>
						<th class="c4">아티스트</th>
						<th class="c5">앨범</th>
						<th class="tColListen">듣기</th>
                		<th class="tColTxt">가사</th>
                		<th class="tColView">뮤비</th>
						<th class="tColPhone">폰</th>
                		<th class="tColMp3">MP3</th>
                		<th class="tColBgm">배경음악</th>
					</tr>
				</thead>
				<tbody>
	#if(($!{songCount}) && $!{songCount} > 0)		
				#set ($count = 0)
				#foreach($song in $songList)
					#set ($count = $count + 1)
					#if($stringUtil.isNotEmpty($!song.song_type_name))
						#set ($track = "track")
					#else
						#set ($track = "")
					#end
					
					#if($StringUtils.equals("$!{song.listen_yn}","Y")) #set ( $_listenAble = true ) #else #set ( $_listenAble = false ) #end
					#if($StringUtils.equals("$!{song.mp3_yn}","Y")) #set ( $_mp3Able = true ) #else #set ( $_mp3Able = false ) #end
					#if($StringUtils.equals("$!{song.bgm_yn}","Y")) #set ( $_bgmAble = true ) #else #set ( $_bgmAble = false ) #end
					<tr class="$track #if($count == 1) first #end">
						<td class="tColChk"><input type="checkbox" name="checkBoxItem" value="${song.song_id}"></td>
						<td class="c3">
							#set ($featT = "")
							#if ($song.getFeatArtist().size() > 0)
								#foreach($feat in $song.getFeatArtist()) 
									#if ($foreach.index > 0) #set ($featT = $featT + ", ") #end
									#set ($featT = $featT + $feat)
								#end
								#set ($featT = "(feat. "+ $featT + ")")
							#else
								#set ($featT = "")
							#end 
							
							#if ($_listenAble)
								##툴팁에는 전체 타이틀 길이 적용
								<a href="javascript:;" onclick="titleSong('$!{song.song_id}', $_listenAble);return gLink(null, 'SRSY', '1', '$!{count}');" title="#getStrongText($!{song.song_name_tooltip}) 곡 듣기" class="gray_d2">
								$!{song.song_name} $!{featT} #if(!$StringUtils.isEmpty("$!{song.info}"))($!{song.info})#end</a>
							#else		
								##툴팁에는 전체 타이틀 길이 적용						
								<span class="gray" title="#getStrongText($!{song.song_name_tooltip})">$!{song.song_name} ${featT} #if(!$StringUtils.isEmpty("$!{song.info}"))($!{song.info})#end</span>
							#end							
							#if($StringUtils.equals("$!{song.song_adult_yn}","Y"))
							<span class="btSetTitleIcon icoProductAdult">&nbsp;</span>
							#end
						</td>
						<td class="c4">
#foreach($artist in $song.getKeyArtistList())##
#**##if ($foreach.index > 0), #end##
#**##if($StringUtils.isNotEmpty("$!{artist.artistId}") && !$StringUtils.equals("$!{artist.artistId}","0"))<a href="/artist/artist.do?artistId=$!{artist.artistId}" class="gray_d2" onclick="return gLink(null, 'SRSY', '2', '$!{count}');">$!{artist.name}</a>#else$!{artist.name}#end
#end##
						</td>
						<td class="c5"><a href="/album/album.do?albumId=$!{song.album_id}" class="gray_d2" onclick="return gLink(null, 'SRSY', '3', '$!{count}');">#if(${song.album_vol})${song.album_vol}#end ${song.album_name}</a></td>		
						<td class="tColListen"><input type="button" class="typeBtn btSetMini btMiniListen#if(!$!{song.song_id}||!$_listenAble)_dis#end" #if(!$!{song.song_id}||!$_listenAble)disabled#end id="listen_$!{song.song_id}" value="곡 듣기" title="곡 듣기" onclick="listenSong('$!{song.song_id}');return gLink(null, 'SRSY', '4', '$!{count}');"></td>
            			<td class="tColTxt"><input type="button" class="typeBtn btSetMini btMiniTxt#if(!$!{song.song_id}||$StringUtils.equals("$!{song.lyrics_yn}","N"))_dis#end" #if($StringUtils.equals("$!{song.lyrics_yn}","N")) value="가사 등록" title="가사 등록"#else value="가사 보기" title="가사 보기"#end onclick="lyricMini('$!{song.song_id}');return gLink(null, 'SRSY', '5', '$!{count}');"></td>
            			<td class="tColView"><input type="button" class="typeBtn btSetMini btMiniView#if(!$!{song.mv_id})_dis#end" #if(!$!{song.mv_id})disabled#end id="video_$!{song.mv_id}" value="뮤비 보기" title="뮤비 보기" onclick="viewVideo('$!{song.song_id}', '$!{song.mv_id}');return gLink(null, 'SRSY', '6', '$!{count}');"></td>
            			<td class="tColPhone"><input id="phone_$!{song.song_id}" class="typeBtn btSetMini btMiniPhone#if(!$!{song.song_id}||!$song.getMobileItemYn())_dis#end" type="button" #if(!$!{song.song_id}||!$song.getMobileItemYn())disabled#end onclick="phoneMini('$!{song.song_id}', this, '$!{song.ring_sales_yn}', '$!{song.bell_sales_yn}');"/></td>
                		<td class="tColMp3"><input type="button" class="typeBtn btSetMini btMiniMp3#if(!$!{song.song_id}||!$_mp3Able)_dis#end" #if(!$!{song.song_id}||!$_mp3Able)disabled#end id="mp3_$!{song.song_id}" onclick="mp3Mini('$!{song.song_id}', this);return gLink(null, 'SRSY', '7', '$!{count}');"></td>
                		<td class="tColBgm"><input type="button" class="typeBtn btSetMini btMiniBgm#if(!$!{song.song_id}||!$_bgmAble)_dis#end" #if(!$!{song.song_id}||!$_bgmAble)disabled#end id="bgm_$!{song.song_id}" onclick="bgmMini('$!{song.song_id}', this);return gLink(null, 'SRSY', '8', '$!{count}');"></td>
					#*			
						<td class="tColListen">#printListItemButton( $!{song.song_id}, "listen", $_listenAble )</td>
            			<td class="tColTxt">#printListItemButton( ${song.song_id}, "words", $!{song.lyrics_yn} )</td>
            			<td class="tColView">#printListItemButton( $!{song.mv_id}, "view", $!{song.mv_id} )</td>
                		<td class="tColMp3">#printListItemButton( $!{song.song_id}, "mp3", $_mp3Able )</td>
                		<td class="tColBgm">#printListItemButton( $!{song.song_id}, "bgm", $_bgmAble )</td>*#
					</tr>
				## 	#if($stringUtil.isNotEmpty($!song.song_type_name))	
				## 	<tr class="join">
				## 		<td colspan="2"></td>
				## 		<td class="t1" colspan="7">
				## 			<a href="#">원곡</a><span class="vline"> | </span><a href="#">$!{song.song_type_name}</a>
				## 		</td>
				## 	</tr>
				## 	#end
				#end	
		#else			
					<tr class="first"><td style="text-align:center;height:60px;" colspan="8">곡/노래 검색결과가 없습니다.</td><tr>	
		#end    	
				</tbody>
				</table>
				<script type="text/javascript">
					var controlBtn = new Music.ControlListButton();
					var ds = new DragSelector(daum.$("wAbmTbl"));
				</script>
				
				##set ($publicUrl = "?query=$!{command.encodedQuery}" + $!artistUrl + $!genreUrl + $!releaseUrl)
				
				<script type="text/javascript">
				function _jsChkListenYN( ctrlCheckBox ) {
			        var _flag = false;
			        var listenFilterYN = "";
			        var bgmFilterYN = "";
			        			   		
			   		if (UI.$("checkBoxR1").checked) listenFilterYN = "&listenFilter=y"
			   		if (UI.$("checkBoxR2").checked) bgmFilterYN = "&bgmFilter=y"
			    
			        if( typeof( ctrlCheckBox ) == "object" ){
		##	          window.location.href = "/search/song.do?query=#escScript($!{command.query})&artistId=$!{command.artistId}&typeId=$!{command.typeId}&genreId=$!{command.genreId}&nationId=$!{command.nationId}&releaseYear=$!{command.releaseYear}&activeYear=$!{command.activeYear}&searchRange=$!{command.searchRange}"+listenFilterYN+bgmFilterYN;
			        }
			    } 

			    var listenFilter = "${command.listenFilter}";
			    var bgmFilter = "${command.bgmFilter}";
			    if (listenFilter == "y") {
			    	UI.$("checkBoxR1").checked = true;
			    }
			    if (bgmFilter == "y") {
			    	UI.$("checkBoxR2").checked = true;
			    }
				</script>
			</div>
		</div>
	</div>
	<div class="collBottom"></div>

<!-- 페이징 -->	
	#if(($!{songCount}) && $!{songCount} > 0)		
		#if( $StringUtils.isNotEmpty("$!{command.sortType}") ) #set ($url = $url + "&sortType=$!{command.sortType}") #end
		#printPagingClickLog("${url}&pageNo=", $dto.ph.pageNo, $dto.ph, "", 10)
	#end
#end	
	
	<!--검색결과 없음 -->
	#if($StringUtils.equals($!{songview},"off"))
 ##   #if($songCount <= 0)
		<div class="rsltHelp">
    		<p><span class="dot">ㆍ</span>검색어의 단어 수를 줄이거나, 보다 일반적인 단어로 검색해 보세요.</p>
    		<p><span class="dot">ㆍ</span>두 단어 이상의 키워드로 검색 하신 경우, 정확하게 띄어쓰기를 한 후 검색해 보세요.</p>
    		<p><span class="dot">ㆍ</span>키워드에 있는 특수문자를 뺀 후에 검색해 보세요.</p>
    	</div>
	</div>
	#end
		
<!-- 제보 -->
##	<hr/><div id="wInfoArea"><span class="tit">지금 보시는 검색 결과에 추가, 수정이 필요한 내용을 직접 등록해 주세요.</span><input type="button" class="typeBtn btnInfo fl" value="제보하기" title="제보하기"></div>
	
<!-- 클릭로그 -->
<script type="text/javascript">init("SY", "$!{command.eucKrQuery}", "-1", "@@@");</script>

#end